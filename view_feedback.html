<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ความคิดเห็นจากผู้ใช้</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', Arial, sans-serif; margin: 0; display: flex; }
    nav.sidebar { width: 220px; background: #333; color: #fff; min-height: 100vh; padding: 20px; }
    nav.sidebar h2 { font-size: 20px; margin-bottom: 20px; }
    nav.sidebar a { display: block; color: #fff; text-decoration: none; margin-bottom: 10px; padding: 10px; background: #444; border-radius: 5px; }
    nav.sidebar a:hover { background: #555; }
    main.content { flex: 1; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f2f2f2; }
    /* ปุ่มลบ */
    .btn-delete {background-color: #f44336;color: white;border: none;padding: 6px 12px;  /* ปรับให้สูง/กว้างเท่ากัน */border-radius: 5px;cursor: pointer;font-size: 14px;display: inline-block; /* ทำให้สามารถจัด layout ได้ */text-align: center;}
    /* hover effect */
    .btn-delete:hover {opacity: 0.8;}
    /* ให้ cell ของปุ่มจัดกึ่งกลางแนวตั้งและแนวนอน */
    td:last-child {text-align: center; /* กึ่งกลางแนวนอน */vertical-align: middle; /* กึ่งกลางแนวตั้ง */width: 100px; /* กำหนดความกว้างคงที่เพื่อให้ปุ่มไม่ลอย */}
  </style>
</head>
<body>

  <nav class="sidebar">
    <h2>เมนู</h2>
    <a href="homepage_admin.html">HOME PAGE</a>
    <a href="manage_user.html">จัดการผู้ใช้งาน</a>
    <a href="create_answer.html">เพิ่มคำตอบนักเรียน</a>
    <a href="show_answer.html">ตรวจสอบคำตอบนักเรียน</a>    
    <a href="view_feedback.html">ตรวจสอบความคิดเห็นของผู้ใช้งาน</a>
    <a href="settings.html">ตั้งค่าระบบ</a>
    <a href="login.html">ออกจากระบบ</a>
  </nav>

  <main class="content">
    <h1>ความคิดเห็นจากผู้ใช้งาน</h1>

    <table id="feedbackTable">
      <thead>
        <tr>
          <th>ชื่อผู้ส่ง</th>
          <th>ชื่อผู้ใช้</th>
          <th>ข้อความ</th>
          <th>วันที่</th>
          <th>การดำเนินการ</th>
        </tr>
      </thead>
      <tbody>
        <!-- ข้อมูล feedback จะถูกเติมด้วย JS -->
      </tbody>
    </table>
  </main>

  <script>
    async function loadFeedback() {
      try {
        const response = await fetch('http://127.0.0.1:8000/api/contact-admin-all');
        const data = await response.json();
        console.log(data); // ตรวจสอบข้อมูล

        const tbody = document.querySelector('#feedbackTable tbody');
        tbody.innerHTML = '';

  
        data.forEach(item => {
          const tr = document.createElement('tr');
          const date = new Date(item.created_at).toLocaleDateString('th-TH', {
            day:'2-digit', month:'long', year:'numeric'
          });
          tr.innerHTML = `
            <td>${item.name}</td>
            <td>${item.username}</td>
            <td>${item.message}</td>
            <td>${date}</td>
            <td>
              <button class="btn-delete" onclick="deleteFeedback(${item.contact_id}, this)">ลบ</button>
            </td>

          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error('Error:', err);
      }
    }

    async function deleteFeedback(id, button) {
      if (!confirm("คุณแน่ใจหรือไม่ว่าต้องการลบข้อความนี้?")) return;

      try {
        const res = await fetch(`http://127.0.0.1:8000/api/contact-admin/${id}`, {
          method: 'DELETE'
        });

        if (res.ok) {
          alert("ลบสำเร็จ");
          // ลบ row ในตารางทันที
          button.closest('tr').remove();

          // ถ้าตารางว่างหลังลบ แสดงข้อความ "ไม่มีข้อความ"
          const tbody = document.querySelector('#feedbackTable tbody');
          if (tbody.children.length === 0) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td colspan="5" style="text-align:center; color:#888;">ไม่มีข้อความ</td>`;
            tbody.appendChild(tr);
          }    

        } else {
          const err = await res.json();
          alert("ลบไม่สำเร็จ: " + err.detail);
        }
      } catch (error) {
        console.error("Error:", error);
      }
    }

    // โหลด feedback ตอนเปิดหน้า
    loadFeedback();
    </script>

</body>
</html>



